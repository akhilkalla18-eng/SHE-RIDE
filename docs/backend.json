{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the SheRide application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile, matching Firebase Auth UID."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number, used for OTP verification."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "city": {
          "type": "string",
          "description": "User's city of residence."
        },
        "aadhaarId": {
          "type": "string",
          "description": "User's Aadhaar ID or College ID (optional)."
        },
        "profileVerified": {
          "type": "boolean",
          "description": "Indicates if the user's profile is verified by an admin."
        },
        "emergencyContact": {
          "type": "string",
          "description": "User's emergency contact phone number."
        },
        "isRider": {
          "type": "boolean",
          "description": "Indicates if the user is a rider (pickup provider)."
        },
        "isPassenger": {
          "type": "boolean",
          "description": "Indicates if the user is a passenger (service requester)."
        }
      },
      "required": [
        "id",
        "name",
        "phoneNumber",
        "email",
        "city"
      ]
    },
    "PickupRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PickupRequest",
      "type": "object",
      "description": "Represents a pickup request created by a rider (Woman X).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pickup request."
        },
        "riderId": {
          "type": "string",
          "description": "UID of the rider creating the request."
        },
        "startingLocation": {
          "type": "string",
          "description": "Starting location of the ride."
        },
        "destination": {
          "type": "string",
          "description": "Destination of the ride."
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time of the ride.",
          "format": "date-time"
        },
        "vehicleType": {
          "type": "string",
          "description": "Type of vehicle (Bike / Scooty)."
        },
        "seatsAvailable": {
          "type": "number",
          "description": "Number of seats available (default 1)."
        },
        "expectedCost": {
          "type": "number",
          "description": "Expected cost of the ride (optional)."
        },
        "routePreference": {
          "type": "string",
          "description": "Rider's preferred route."
        },
        "status": {
            "type": "string",
            "description": "The current status of the request (e.g., 'open', 'matched')."
        }
      },
      "required": [
        "id",
        "riderId",
        "startingLocation",
        "destination",
        "dateTime",
        "vehicleType",
        "seatsAvailable",
        "status"
      ]
    },
    "ServiceRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceRequest",
      "type": "object",
      "description": "Represents a service request created by a passenger (Woman Y).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service request."
        },
        "passengerId": {
          "type": "string",
          "description": "UID of the passenger creating the request."
        },
        "pickupLocation": {
          "type": "string",
          "description": "Pickup location for the service."
        },
        "destination": {
          "type": "string",
          "description": "Destination for the service."
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time for the service.",
          "format": "date-time"
        },
        "maxAmount": {
          "type": "number",
          "description": "Maximum amount willing to pay."
        },
        "preferredRoute": {
          "type": "string",
          "description": "Passenger's preferred route."
        },
         "status": {
            "type": "string",
            "description": "The current status of the request (e.g., 'open', 'matched')."
        }
      },
      "required": [
        "id",
        "passengerId",
        "pickupLocation",
        "destination",
        "dateTime",
        "maxAmount",
        "status"
      ]
    },
    "Ride": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ride",
      "type": "object",
      "description": "Represents a confirmed ride between a rider and a passenger.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ride."
        },
        "pickupRequestId": {
          "type": "string",
          "description": "Reference to the PickupRequest."
        },
        "serviceRequestId": {
          "type": "string",
          "description": "Reference to the ServiceRequest."
        },
        "participantIds": {
            "type": "array",
            "description": "Array containing the UIDs of both the rider and the passenger.",
            "items": { "type": "string" }
        },
        "status": {
          "type": "string",
          "description": "Status of the ride (Requested, Accepted, Confirmed, Completed, Cancelled)."
        },
        "sharedCost": {
          "type": "number",
          "description": "The agreed shared cost between the rider and passenger."
        },
        "dateTime": {
            "type": "string",
            "description": "The date and time of the confirmed ride.",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "participantIds",
        "status",
        "dateTime"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat conversation between a rider and a passenger.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat."
        },
        "rideId": {
          "type": "string",
          "description": "Reference to the Ride."
        },
        "messages": {
          "type": "array",
          "description": "Array of message objects in the chat.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "rideId"
      ]
    },
    "SOSAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SOSAlert",
      "type": "object",
      "description": "Represents an SOS alert triggered by a user during a ride.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SOS alert."
        },
        "userId": {
          "type": "string",
          "description": "UID of the user who triggered the alert."
        },
        "rideId": {
          "type": "string",
          "description": "Reference to the Ride during which the alert was triggered."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the alert was triggered.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Location of the user when the alert was triggered (e.g., coordinates)."
        },
        "details": {
          "type": "string",
          "description": "Additional details about the emergency situation."
        }
      },
      "required": [
        "id",
        "userId",
        "rideId",
        "timestamp",
        "location"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores private user profile information. Only the user with the matching {userId} can write to their own document."
        }
      },
      {
        "path": "/pickupRequests/{pickupRequestId}",
        "definition": {
            "entityName": "PickupRequest",
            "schema": { "$ref": "#/backend/entities/PickupRequest" },
            "description": "Top-level collection for ride offers. Listable by any authenticated user for discovery, but writable only by the owner."
        }
      },
       {
        "path": "/serviceRequests/{serviceRequestId}",
        "definition": {
            "entityName": "ServiceRequest",
            "schema": { "$ref": "#/backend/entities/ServiceRequest" },
            "description": "Top-level collection for ride requests. Listable by any authenticated user for discovery, but writable only by the owner."
        }
      },
      {
        "path": "/rides/{rideId}",
        "definition": {
          "entityName": "Ride",
          "schema": {
            "$ref": "#/backend/entities/Ride"
          },
          "description": "Stores confirmed ride information. Access is controlled based on the participantIds field within the document."
        }
      },
      {
        "path": "/rides/{rideId}/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores chat messages associated with a specific ride. Only users involved in the ride can access the chat."
        }
      },
      {
        "path": "/sos_alerts/{sosAlertId}",
        "definition": {
          "entityName": "SOSAlert",
          "schema": {
            "$ref": "#/backend/entities/SOSAlert"
          },
          "description": "Stores SOS alerts triggered by users. Access is restricted to the user who created it."
        }
      }
    ],
    "reasoning": "The Firestore data structure has been revised for better security and scalability. User profiles remain in a private `/users/{userId}` collection. Crucially, pickup and service requests are now in their own top-level collections (`/pickupRequests` and `/serviceRequests`) to allow for public discovery without compromising user privacy. Security rules will allow any authenticated user to read these collections, but only the creator can write or modify their own documents. Confirmed rides are in a `/rides` collection, with access restricted to the participants listed in the `participantIds` array within each ride document. This prevents costly and insecure cross-user queries and follows Firestore's best practices for scalable, secure app development."
  }
}
